version: '3.4'

x-defaults: &defaults
  restart: unless-stopped
  image: jenkins/jenkins:lts
  env_file: ./config/env/jenkins.env
  volumes:
    - jenkins-home:/var/jenkins_home

services:
  web:
    <<: *defaults
    ports:
      - ${PORT}:8080
    networks: 
      - default
      - traefik
    labels:
      - traefik.enable=true
      - traefik.http.routers.my-app.rule=Host(`${HOST}`)
      - traefik.http.services.my-app.loadbalancer.server.port=${PORT}
      - traefik.http.routers.my-app.entrypoints=websecure
      - traefik.http.routers.my-app.tls=true
      - traefik.http.routers.my-app.tls.certresolver=leresolver
volumes:
  jenkins-home:
networks: 
  traefik:
    external:
      name: ${TRAEFIK_NETWORK}
